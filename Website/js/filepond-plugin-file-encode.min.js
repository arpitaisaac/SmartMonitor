/*
 * FilePondPluginFileEncode 2.1.1
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */

/* eslint-disable */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.FilePondPluginFileEncode=n()}(this,function(){"use strict";var u=function(){self.onmessage=function(n){e(n.data.message,function(e){self.postMessage({id:n.data.id,message:e})})};var e=function(e,n){var i=e.file,t=new FileReader;t.onloadend=function(){n(t.result.replace("data:","").replace(/^.+,/,""))},t.readAsDataURL(i)}},e=function(e){var n=e.addFilter,i=e.utils,t=i.Type,o=i.createWorker,a=i.createRoute,r=i.isFile,d=function(e){var t=e.name,a=e.file;return new Promise(function(n){var i=o(u);i.post({file:a},function(e){n({name:t,data:e}),i.terminate()})})},f=[];return n("SHOULD_PREPARE_OUTPUT",function(){return new Promise(function(e){e(!0)})}),n("COMPLETE_PREPARE_OUTPUT",function(i,e){var t=e.item;return new Promise(function(n){if(!r(i)&&!Array.isArray(i))return n(i);f[t.id]={metadata:t.getMetadata(),imagedata:null},Promise.all((i instanceof Blob?[{name:null,file:i}]:i).map(d)).then(function(e){f[t.id].imagedata=i instanceof Blob?e[0].data:e,n(i)})})}),n("CREATE_VIEW",function(e){var n=e.is,i=e.view,d=e.query;n("file-wrapper")&&d("GET_ALLOW_FILE_ENCODE")&&i.registerWriter(a({DID_PREPARE_OUTPUT:function(e){var n=e.root,i=e.action;if(!d("IS_ASYNC")){var t=d("GET_ITEM",i.id);if(t){var a=f[t.id],o=a.metadata,r=a.imagedata;n.ref.data.value=JSON.stringify({id:t.id,name:t.file.name,type:t.file.type,size:t.file.size,metadata:o,data:r}),f[t.id].imagedata=null}}}}))}),{options:{allowFileEncode:[!0,t.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:e})),e});